{
  "hash": "2b50ee411e312f57721216ec75112e8a",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat: html\n---\n\n\n\n<style>\npre code {\ncolor: white\n}\n</style>\n\n<center>\n::: text\n\n## Helly vs. Helena, a voice analysis\n\nTo my ear, Helena's voice has always sounded deeper to me compared to Helly's. I first noticied this when <span class=\"spoiler\">I suspected that it was Helena on the severed floor at the beginning of season 2</span>, and have continued to hear it. Now after episode 9, I am again wondering who is actually on the severed floor, so I decided to see if we could collect some data. I started by taking a random sample of vocals we know are Helly's. I took the transcript data from the [mdr](https://lucymcgowan.github.io/mdr) R package and filtered to include just rows where Helly was the speaker and the dialogue was at least 100 characters. I then randomly sampled 10 (although we ended up with 9, one was accidentally a line from season 1 episode 4 where Helena was speaking to Helly via the TV). Here is my Helly sample:\n\n:::\n\n</center>\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(mdr)\nlibrary(glue)\nlibrary(voice)\nlibrary(tidyverse)\nlibrary(tidymodels)\n\nset.seed(2938)\n\nhelly_sample <- transcripts |>\n  filter(grepl(\"Helly\", speaker),\n         nchar(dialogue) > 100,\n         (season == 1 & episode != 9 | season == 2 & episode == 5),\n         !(season == 1 & episode == 1 & minute(timestamp) == 30)) |>\n  slice_sample(n = 10) |>\n  arrange(season, episode)\n\nhelena_sample <- transcripts |>\n  filter(grepl(\"Helly\", speaker),\n         nchar(dialogue) > 100,\n         season == 2, episode %in% c(1, 4)) |>\n  arrange(season, episode) |>\n  slice(1:5)\n\nhelly_sample\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 5\n   season episode timestamp speaker dialogue                                    \n    <int>   <int> <time>    <chr>   <chr>                                       \n 1      1       2 14'50\"    Helly   I really don’t. I guess I went home last ni…\n 2      1       2 48'10\"    Helly   Okay, but how good are the scanners? Like, …\n 3      1       3 46'56\"    Helly   “Forgive me for the harm I have caused this…\n 4      1       3 22'14\"    Helly   Mark, I don’t wanna work here with you. So …\n 5      1       4 21'16\"    Helly   Well, boss. I guess this is the part where …\n 6      1       4 21'56\"    Helly   Helly, I watched your video asking that I r…\n 7      1       5 39'37\"    Helly   I mean, what if the goats are the numbers? …\n 8      1       7 35'18\"    Helly   Yeah, see. There are two lever switches tha…\n 9      1       8 28'07\"    Helly   And we don’t know how long Dylan will be ab…\n10      2       5 25'10\"    Helly   You don't. You just have to trust me. This …\n```\n\n\n:::\n:::\n\n\n\n<center>\n::: text\nI then sampled the same from the episodes we know are Helena. After filtering to only lines of dialogue that were at least 100 characters, excluding one where she and Mark are laughing (so the audio is messy), we ended up with 5 such samples.\n:::\n\n</center>\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 5\n  season episode timestamp speaker dialogue                                     \n   <int>   <int> <time>    <chr>   <chr>                                        \n1      2       1 33'06\"    Helly R \"Then I went outside and found a guy. He loo…\n2      2       1 36'25\"    Helly R \"Right. Of course. I mean, assuming she's st…\n3      2       1 36'54\"    Helly R \"We're not the same, actually. Us and the ou…\n4      2       4 10'36\"    Helly   \"\\\"I was not born into this world alone. The…\n5      2       4 10'55\"    Helly   \"\\\"In infancy, he was my bosom friend. But a…\n```\n\n\n:::\n:::\n\n\n\n<center>\n\n::: text\n\nI likewise took a sample from episode 9, when Helly/Helena was talking to Dylan (labeled 'unknown' below). I then recorded the audio and estimated the fundamental frequency through a short-term cepstral transform. The figure below shows the distribution of average fundamental frequency by who was speaking. Notably, the 'unknown' sample aligns more closely with Helena than with Helly. Specifically, the mean pitch of 'unknown' falls within Helena’s interquartile range (the 'box'), whereas it aligns with Helly’s whiskers (the less common values).\n\n</center>\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nget_path <- function(n, who) {\n  glue(\"data/o{n}_{who}.wav\")\n}\nget_pitch <- function(path, i) {\n  pitch_values <- extract_features(path, stereo2mono = TRUE) |>\n    as_tibble()\n  max_seconds <- max(pitch_values$section_seq_file)\n  pitch_values$norm_section <- pitch_values$section_seq_file / max_seconds\n  pitch_values |>\n    mutate(i = i) |>\n    select(norm_section, f0:f8, i)\n}\n\nget_avg_pitch <- function(pitch_values, what = \"f0\") {\n  pitch_values <- pitch_values |> filter(f0 < 300)\n  tibble(mean = mean(pitch_values[[what]], na.rm = TRUE),\n         sd = sd(pitch_values[[what]], na.rm = TRUE),\n         median = median(pitch_values[[what]], na.rm = TRUE),\n         skewness = moments::skewness(pitch_values[[what]], na.rm = TRUE),\n         kurtosis = moments::kurtosis(pitch_values[[what]], na.rm = TRUE))\n}\n\nhelly_path <- purrr::map(1:9, get_path, who = \"helly\")\nhelly_pitch <- purrr::imap(helly_path, get_pitch) \nhelly_pitch_df <- helly_pitch |> bind_rows()\n\nhelena_path <- purrr::map(1:5, get_path, who = \"helena\")\nhelena_pitch <- purrr::imap(helena_path, get_pitch) \nhelena_pitch_df <- helena_pitch |> bind_rows()\n\nunknown_pitch <- get_pitch(\"data/q1.wav\", 1) \n\n\nhelly_avg <- purrr::map_df(helly_pitch, get_avg_pitch)\nhelly_avg$class <- \"helly\"\nhelena_avg <- purrr::map_df(helena_pitch, get_avg_pitch)\nhelena_avg$class <- \"helena\"\nunknown_avg <- get_avg_pitch(unknown_pitch)\nunknown_avg$class <- \"unknown\"\ndata <- bind_rows(helly_avg, helena_avg, unknown_avg)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nggplot(data, aes(x = mean, y = class, fill = class, color = class)) +\n  geom_vline(xintercept = data$mean[data$class == \"unknown\"], linetype = \"dashed\", color = \"white\") +\n  geom_boxplot(alpha = 0.75, linewidth = 1.5) +\n  labs(x = \"Average pitch (fundamental frequency in Hz)\", y = \"\") + \n  annotate(\"text\", x = 60, y = 3.2, \n           label = \"\\\"unknown\\\" matches Helena's\\ncentral tendency, not Helly's\", \n           color = \"yellow\", size = 4.5,\n           fontface = \"bold\", hjust = 0) +\n  annotate(\"curve\", x = 80, xend = 130, \n           y = 3, yend = 2.8, \n           curvature = 0.3,\n           arrow = arrow(length = unit(0.2, \"inches\"), type = \"closed\"), \n           color = \"yellow\", linewidth = 1.2) +\n  annotate(\"curve\", x = 80, xend = 130, \n           y = 3, yend = 1.1, \n           curvature = 0.3,\n           arrow = arrow(length = unit(0.2, \"inches\"), type = \"closed\"), \n           color = \"yellow\", linewidth = 1.2) +\n  scale_fill_manual(values = c(\"#C15C58\", \"#5BA9D0\", \"yellow\")) + \n  scale_color_manual(values = c(\"#C15C58\", \"#5BA9D0\", \"yellow\")) +\n  theme_mdr() + \n  theme(legend.position = \"none\",\n        axis.text = element_text(size = 20),\n        axis.title = element_text(size = 20),\n        panel.grid = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n<center>\n\n::: text\nI extracted pitch features including the mean, standard deviation, median, skewness, and kurtosis of the fundamental frequencies. I fit a logistic regression model using these features. The model was trained on the known audio samples from Helly and Helena. I then classified the unknown sample based on the model. And look at that, it predicted that the unknown audio was from *Helena* not Helly.\n\n:::\n\n</center>\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidymodels)\n\nmodel <- fit(logistic_reg(), \n             factor(class) ~ ., \n             data = data |> filter(class != \"unknown\"))\n\npredict(model, new_data = data |> filter(class == \"unknown\"), type = \"prob\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  .pred_helena  .pred_helly\n         <dbl>        <dbl>\n1         1.00 0.0000000364\n```\n\n\n:::\n:::\n\n\n<center>\n::: text\n\nThe output suggests that based on the model I fit the probability that the unknown source was actually Helena is essentially 100% (*Note: as a statistician I feel the need to make some clarifications, this model is silly, this application is silly, we have a very small number of observations, etc.*).\n\n:::\n</center>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}